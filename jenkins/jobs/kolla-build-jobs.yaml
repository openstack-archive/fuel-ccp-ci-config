#
# Template for job executed manually
#
- job-template:
    name: build-all-job-{repo}
    description: |
      Kolla build job executed manually or by merged event
    node: standard
    properties:
      - inject:
          properties-content: |
            BUILD_ALL=true
    builders:
      - shell:
          !include-raw-escape 'builders/kolla_docker_build.sh'
    concurrent: true
    wrappers:
      - nextgen-ci-jenkins
    scm:
      - fuel-infra:
          scm-basedir: ''
          scm-branch: '{branch}'
          scm-repo: 'openstack/{repo}'
    triggers:
      - fuel-infra-patchset-merged:
          project-pattern: 'openstack/{repo}'
    publishers:
      - logs-private

#
# Templates for job triggered by gerrit events
#
- job-template:
    name: build-changed-trigger-job-{repo}
    description: |
      Kolla build job executed by trigger
    node: standard
    properties:
      - inject:
          properties-content: |
            BUILD_ALL=false
    builders:
      - shell:
          !include-raw-escape 'builders/kolla_docker_build.sh'
    concurrent: true
    wrappers:
      - nextgen-ci-jenkins
    scm:
      - fuel-infra_trigger:
          scm-basedir: ''
          scm-branch: '{branch}'
          scm-repo: 'openstack/{repo}'
    triggers:
      - fuel-infra:
          project-pattern: 'openstack/{repo}'
    publishers:
      - logs-private

- project:
    name: kolla-build-jobs
    jobs:
       - 'build-all-job-{repo}'
       - 'build-changed-trigger-job-{repo}'
    repo:
       - 'kolla':
           branch: 'mirantis'
