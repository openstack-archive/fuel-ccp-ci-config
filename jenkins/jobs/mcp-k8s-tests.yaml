- job-template:
    name: mcp-k8s-test-{test_name}
    description: |
      Kubernetes unit test
    node: k8s-xenial
    builders:
      - inject:
          properties-content: |
            TEST_SCRIPT={test_script}
      - shell:
          !include-raw-escape builders/mcp-k8s-clone-repo.sh
      - shell:
          !include-raw-escape builders/mcp-k8s-test.sh

    concurrent: true
    wrappers:
      - ng-cleanup
      - nextgen-ci-jenkins

    publishers:
      - archive:
          allow-empty: true
          artifacts: '_artifacts/*'
          latest-only: false

- project:
    name: mcp-k8s-tests
    test_name:
      - unit:
          test_script: ./hack/test-go.sh
      - integration:
          test_script: ./hack/test-integration.sh
    jobs:
      - 'mcp-k8s-test-{test_name}'
