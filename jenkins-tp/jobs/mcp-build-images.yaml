- job-template:
    name: mcp-build-images-latest
    description: |
      Build MCP Docker images and store them into Docker registry with latest tag.
    node: standard
    builders:
      - inject:
          properties-content: |
            TAG=latest
      - shell:
          !include-raw-escape 'builders/mcp-build-images.sh'
    concurrent: false
    scm:
      - openstack:
          scm-basedir: ''
          scm-branch: 'master'
          scm-repo: 'fuel-ccp'
    wrappers:
      - ng-cleanup

- job-template:
    name: mcp-build-images-build-number
    description: |
      Build MCP Docker images and store them into Docker registry with BUILD_NUMBER as a tag.
    node: standard
    builders:
      - inject:
          properties-content: |
            TAG=$BUILD_NUMBER
      - shell:
          !include-raw-escape 'builders/mcp-build-images.sh'
    concurrent: true
    scm:
      - openstack:
          scm-basedir: ''
          scm-branch: 'master'
          scm-repo: 'fuel-ccp'
    wrappers:
      - ng-cleanup
    publishers:
      - email-image-build:
          body-failed:
            !include-raw notifications/image_build.failed
          mail-to: mos-microservices@mirantis.com

- job-template:
    name: mcp-clean-docker-registry
    description: |
      Remove old tags from MCP Docker registry.
    node: standard
    builders:
      - inject:
          properties-content: |
            LEAVE_LAST_RECENT_TAGS=6
            DOCKER_REGISTRY="registry.mcp.fuel-infra.org"
            DOCKER_NAMESPACE="mcp"
      - shell:
          !include-raw-escape 'builders/mcp-clean-docker-registry.sh'
    concurrent: false
    wrappers:
      - ng-cleanup

- project:
    name: Build MCP Docker images and store them into Docker registry.
    jobs:
       - 'mcp-build-images-latest'
       - 'mcp-build-images-build-number'
       - 'mcp-clean-docker-registry'
