- job-template:
    name: mcp-build-images-latest
    description: |
      Build MCP Docker images and store them into Docker registry with latest tag.
    node: standard
    builders:
      - inject:
          properties-content: |
            TAG=latest
            PURGE=false
      - shell:
          !include-raw-escape 'builders/mcp-build-images.sh'
    concurrent: false
    scm:
      - openstack:
          scm-basedir: ''
          scm-branch: 'master'
          scm-repo: 'fuel-ccp'
    wrappers:
      - ng-cleanup

- job-template:
    name: mcp-build-images-build-number
    description: |
      Build MCP Docker images and store them into Docker registry with BUILD_NUMBER as a tag.
    node: standard
    builders:
      - inject:
          properties-content: |
            TAG=$BUILD_NUMBER
            PURGE=true
            PURGE_COUNT=5
      - shell:
          !include-raw-escape 'builders/mcp-build-images.sh'
    concurrent: true
    scm:
      - openstack:
          scm-basedir: ''
          scm-branch: 'master'
          scm-repo: 'fuel-ccp'
    wrappers:
      - ng-cleanup
   publishers:
      - email-image-build:
          body-failed:
            !include-raw notifications/image_build.failed
          mail-to: mos-microservices@mirantis.com

- project:
    name: Build MCP Docker images and store them into Docker registry.
    jobs:
       - 'mcp-build-images-latest'
       - 'mcp-build-images-build-number'
