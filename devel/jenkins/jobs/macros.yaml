#
# Configurable repository sources
#
- scm:
    name: openstack
    scm:
      - git:
         url: 'https://git.openstack.org/openstack/{scm-repo}.git'
         branches:
          - '{scm-branch}'
         basedir: '{scm-basedir}'

- scm:
    name: fuel-infra
    scm:
      - git:
          url: 'ssh://nextgen-ci01-dev@review.fuel-infra.org:29418/{scm-repo}.git'
          basedir: '{scm-basedir}'
          skip-tag: true
          branches:
            - '{scm-branch}'

- scm:
    name: zuul_repo
    scm:
      - git:
          url: $ZUUL_URL/$ZUUL_PROJECT
          branches:
            - $ZUUL_BRANCH

#
# Repository source with gerrit changes
#
- scm:
    name: zuul_repo_trigger
    scm:
      - git:
          basedir: '{scm-basedir}'
          branches:
            - $ZUUL_BRANCH
          remotes:
            - gerrit:
                refspec: $ZUUL_REF
                url: $ZUUL_URL/$ZUUL_PROJECT
#
# Static repositories
#


#
# SSH credentials
#
- wrapper:
    name: nextgen-ci01-dev
    wrappers:
      - ssh-agent-credentials:
          users:
            - 'TBD'

- wrapper:
    name: 'ng-cleanup'
    wrappers:
      - workspace-cleanup

#
# Publishers
#
- publisher:
    name: logs-private
    publishers:
      - archive:
          allow-empty: true
          artifacts: 'logs/*'
          latest-only: false

#
# Builders
#
- builder:
    name: check-tox
    builders:
      - shell: 'tox -v -e {tox-test}'

- builder:
    name: get-from-zuul-container
    builders:
      - shell: |
          git clone ssh://nextgen-ci01-dev@review.fuel-infra.org:29418/nextgen/microservices
          mkdir -p containers/$ZUUL_PROJECT
          cd containers/$ZUUL_PROJECT
          git clone ssh://nextgen-ci01-dev@review.fuel-infra.org:29418/$ZUUL_PROJECT .
          git fetch $ZUUL_URL/$ZUUL_PROJECT $ZUUL_REF
          git checkout FETCH_HEAD

- builder:
    name: get-from-zuul
    builders:
      - shell: |
          git clone ssh://nextgen-ci01-dev@review.fuel-infra.org:29418/$ZUUL_PROJECT .
          git fetch $ZUUL_URL/$ZUUL_PROJECT $ZUUL_REF
          git checkout FETCH_HEAD
          git status
